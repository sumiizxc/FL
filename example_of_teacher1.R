# олоН хүчин зүйлсийн статистик Семинар 7
#
# Principal Component Analysis
# Author: galaa
# Created on 2016/03/19 07:49:41
#

# Library dependence

library(MASS)

# Data

X = matrix(c(3.11, 1.14, -0.10, -1.42, 2.17, 0.59, 0.70, 0.43, 2.55, 0.31, -2.95, -2.32, -1.07, 0.08, -0.32, 0.47, 1.19, 0.10, -1.62, -1.87), nrow = 10, ncol = 2, byrow = TRUE);

# X = matrix(c(9.775, 10.070, 9.852, 9.862, 9.737, 10.000, 10.163, 9.901, 9.833, 9.718, 9.116, 9.690, 9.766, 9.718, 9.843, 9.794, 9.980, 9.940, 10.132, 9.891, 9.690, 9.921, 9.681, 9.804, 9.662, 9.804, 9.990, 10.000, 9.728, 9.671, 9.434, 9.606, 9.709, 9.872, 9.794, 9.398, 9.814, 9.891, 9.921, 9.615, 9.461, 10.000, 10.142, 9.794, 9.891, 9.276, 9.643, 9.833, 9.823, 9.843, 9.653, 9.775, 9.634, 10.225, 9.818, 9.970, 9.780, 9.906, 9.852, 10.055, 9.916, 9.926, 9.794, 9.592, 8.905, 9.542, 9.704, 9.747, 9.685, 9.770, 9.921, 9.886, 10.030, 10.076, 9.483, 9.945, 9.648, 9.556, 9.737, 9.574, 10.142, 9.985, 9.790, 9.799, 9.421, 9.629, 9.560, 9.970, 9.804, 9.294, 9.906, 9.794, 9.916, 9.443, 9.333, 10.010, 9.940, 9.639, 9.886, 9.149, 9.461, 9.713, 9.790, 9.799, 9.611, 9.667, 9.506, 10.352, 8.662, 9.013, 8.734, 8.885, 8.838, 9.031, 8.945, 8.711, 8.840, 8.726, 7.782, 8.617, 8.739, 8.716, 8.909, 8.793, 8.961, 9.023, 9.017, 8.778, 8.258, 8.805, 8.795, 8.626, 8.776, 8.586, 8.838, 8.933, 9.054, 8.816, 8.520, 8.351, 8.619, 8.951, 9.027, 8.225, 8.757, 8.679, 8.675, 8.552, 8.778, 8.965, 8.675, 8.739, 8.969, 8.003, 8.403, 8.897, 8.783, 8.891, 8.562, 8.686, 8.578, 9.264, 7.533, 7.663, 7.533, 7.707, 7.449, 7.843, 7.619, 7.576, 7.533, 7.407, 6.873, 7.130, 7.619, 7.890, 7.366, 7.663, 7.752, 7.707, 7.843, 7.619, 7.326, 7.576, 7.576, 7.286, 7.619, 7.407, 7.707, 7.533, 7.843, 7.663, 7.326, 7.576, 7.449, 7.407, 7.491, 7.407, 7.707, 7.663, 7.797, 7.407, 7.407, 7.752, 7.619, 7.576, 7.797, 6.873, 7.246, 7.707, 7.576, 7.797, 7.449, 7.366, 7.491, 7.797, 6.793, 7.082, 6.983, 7.003, 6.757, 7.003, 7.082, 6.849, 6.925, 6.720, 5.896, 6.510, 6.983, 7.102, 6.702, 6.925, 7.184, 7.082, 7.163, 6.925, 6.684, 6.964, 6.887, 6.631, 7.022, 6.757, 7.463, 6.906, 7.267, 6.868, 6.631, 6.812, 6.649, 6.527, 6.887, 6.579, 7.042, 7.062, 6.906, 6.250, 6.545, 6.964, 7.143, 7.003, 7.062, 6.234, 6.477, 7.184, 6.925, 7.082, 6.631, 6.631, 6.964, 7.225, 6.252, 6.445, 6.285, 6.495, 5.692, 6.182, 6.299, 6.224, 6.210, 6.177, 4.990, 6.061, 6.210, 6.210, 5.823, 6.280, 6.420, 6.455, 6.405, 6.182, 5.961, 6.196, 6.173, 5.864, 6.376, 6.101, 6.366, 6.304, 6.582, 6.021, 5.995, 6.109, 5.906, 5.889, 6.347, 5.873, 6.304, 6.308, 6.356, 5.661, 5.965, 6.270, 6.386, 6.289, 6.313, 5.119, 5.570, 6.391, 6.270, 6.347, 5.991, 5.848, 6.196, 6.425, 6.028, 6.054, 6.013, 6.203, 5.466, 5.925, 6.039, 5.933, 5.916, 5.978, 4.711, 5.785, 5.995, 5.972, 5.477, 6.056, 6.087, 6.092, 6.105, 5.927, 5.681, 5.946, 5.785, 5.621, 6.000, 5.803, 6.109, 6.043, 6.299, 5.846, 5.858, 5.793, 5.650, 5.585, 6.141, 5.627, 6.074, 6.017, 6.052, 5.315, 5.739, 5.976, 6.125, 6.023, 5.974, 4.802, 5.321, 6.118, 5.967, 5.974, 5.708, 5.617, 5.883, 6.121), nrow = 54, ncol = 7, byrow = FALSE);

# Scatterplot
library(car)
df = data.frame(X)
scatterplot(X2~X1, reg.line = lm, smooth = FALSE, spread = FALSE, boxplots = 'xy', span = 0.5, data = df)

# Descriptive Statistics

colMeans(X)
S_square = cov(X)
cor(X[,1],X[,2])

# PCA

pca = prcomp(X, center = TRUE, scale. = FALSE)
Gamma = gpca$rotation
Lambda = diag(pca$sdev)^2

# Coordinates on (PC1,PC2)

pca$x

p = length(X[1,]);
n = length(X[,1]);
m = colMeans(X);
Z = X-matrix(rep(m, n), nrow  = n, ncol = p, byrow = TRUE);
Y = t(t(Gamma) %*% t(Z))
Y = round(Y, digits = 2)
Y

cov(Y)

# Y_i

t(Gamma[,1] %*% t(Z))
t(Gamma[,2] %*% t(Z))

# Covariances of X and Y

cov(X,Y)
Gamma %*% Lambda

# Correlation of X and Y

cor(X,Y)

i = 1; j = 1;
Gamma[i,j]*(Lambda[j,j]/S_square[i,i])^0.5

# Projection on PC1

Y[,2] = Y[,2] * 0;
projection = t(ginv(Gamma) %*% t(Y))
projection = round(projection, digits = 2);
projection

# Linear model

lm(X[,2] ~ X[,1])``
